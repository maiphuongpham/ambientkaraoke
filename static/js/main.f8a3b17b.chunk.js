(this["webpackJsonpaccompaniment-ui"]=this["webpackJsonpaccompaniment-ui"]||[]).push([[0],{277:function(e,t,n){e.exports=n(360)},288:function(e,t){},289:function(e,t){},297:function(e,t){},305:function(e,t){},306:function(e,t){},307:function(e,t){},315:function(e,t){},358:function(e,t,n){},359:function(e,t,n){},360:function(e,t,n){"use strict";n.r(t);var a=n(7),r=n.n(a),c=n(232),l=n.n(c),o=n(258),s=n(17),i=n(94),m=n(12);n(358);var p=function(){const[e,t]=Object(a.useState)(null),[n,c]=Object(a.useState)(""),[l,o]=Object(a.useState)(""),[s,p]=Object(a.useState)(""),[u,d]=Object(a.useState)(!1),[f,w]=Object(a.useState)(null),[y,b]=Object(a.useState)(!1),h=Object(a.useRef)(null),D=Object(a.useRef)(null),F=Object(a.useRef)(null),A=Object(a.useRef)(null),C=Object(a.useRef)(null);Object(a.useEffect)(()=>{const e=new m.Reverb({decay:8,wet:.7}).toDestination(),t=new m.FeedbackDelay({delayTime:"8n",feedback:.025,wet:.1}),n=new m.Filter({type:"lowpass",frequency:1600,Q:1}),a=new m.Volume(-1);a.connect(n),n.connect(t),t.connect(e);const r=new m.Sampler({urls:{A0:"A0.mp3",C1:"C1.mp3","D#1":"Ds1.mp3","F#1":"Fs1.mp3",A1:"A1.mp3",C2:"C2.mp3","D#2":"Ds2.mp3","F#2":"Fs2.mp3",A2:"A2.mp3",C3:"C3.mp3","D#3":"Ds3.mp3","F#3":"Fs3.mp3",A3:"A3.mp3",C4:"C4.mp3","D#4":"Ds4.mp3","F#4":"Fs4.mp3",A4:"A4.mp3",C5:"C5.mp3","D#5":"Ds5.mp3","F#5":"Fs5.mp3",A5:"A5.mp3",C6:"C6.mp3","D#6":"Ds6.mp3","F#6":"Fs6.mp3",A6:"A6.mp3",C7:"C7.mp3","D#7":"Ds7.mp3","F#7":"Fs7.mp3",A7:"A7.mp3",C8:"C8.mp3"},release:1,baseUrl:"https://tonejs.github.io/audio/salamander/",onload:()=>console.log("\u2705 Sampler loaded")}).connect(a);A.current=r;const c=new m.PolySynth(m.Synth,{oscillator:{type:"fatsawtooth",count:3,spread:40},envelope:{attack:.05,decay:.2,sustain:.8,release:1}}),l=new m.Volume(-24);C.current=c;const o=new m.Filter({type:"lowpass",frequency:600,Q:1}),s=new m.Reverb({decay:10,preDelay:.2}).toDestination(),i=new m.FeedbackDelay("4n",.3).connect(s);c.chain(l,o,i);const p=new m.LFO("0.05hz",400,1e3);p.connect(o.frequency),p.start()},[]);const E=async e=>{try{const t=await fetch(e),n=await t.arrayBuffer(),a=i.b(n);w(a),D.current&&(D.current.innerHTML="",F.current=new i.a(a,D.current,{noteRGB:"0, 0, 0",activeNoteRGB:"255, 0, 0",pixelsPerTimeStep:80,noteHeight:6}))}catch(t){console.error("\u274c Failed to load MIDI for preview:",t)}};return r.a.createElement("div",{className:"container"},r.a.createElement("h1",null,"Upload and Generate Accompaniment"),r.a.createElement("input",{type:"file",accept:".wav",onChange:e=>{t(e.target.files[0]),c(""),o(""),w(null),D.current&&(D.current.innerHTML="")}}),r.a.createElement("button",{onClick:async()=>{if(!e)return void alert("Please select a .wav file first.");const t=new FormData;t.append("file",e);try{d(!0);const e=await fetch("http://127.0.0.1:5000/api/upload",{method:"POST",body:t}),n=await e.json();c(e.ok?"\u2705 Uploaded: ".concat(n.filename):"\u274c Upload failed: ".concat(n.error))}catch(n){console.error("\u274c Upload error:",n),c("\u274c Upload failed.")}finally{d(!1)}},style:{marginTop:"10px"},disabled:u},"Upload WAV"),n&&r.a.createElement("p",null,n),r.a.createElement("hr",null),r.a.createElement("button",{onClick:async()=>{try{d(!0);const e=await fetch("http://127.0.0.1:5000/api/generate",{method:"POST"}),t=await e.json();if(e.ok){const e=t.midi_url,n="http://127.0.0.1:5000".concat(e.crossmodal),a="http://127.0.0.1:5000".concat(e.ambient);o(n),p(a),E(n)}else alert("\u274c Generation failed: "+t.error)}catch(e){console.error("\u274c Generation error:",e),alert("\u274c Generation failed.")}finally{d(!1)}},disabled:u||!e},"Generate Accompaniment"),u&&r.a.createElement("p",null,"Processing..."),l&&r.a.createElement("div",{style:{marginTop:"20px"}},r.a.createElement("h3",null,"Generated MIDI"),r.a.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer",download:!0},"Download MIDI"),r.a.createElement("div",{style:{marginTop:"10px"}},r.a.createElement("button",{onClick:async()=>{if(!f||!A.current)return;if(await m.start(),s)try{const e=await fetch(s),t=await e.arrayBuffer(),n=i.b(t);new m.Part((e,t)=>{C.current.triggerAttackRelease(m.Frequency(t.pitch,"midi"),t.endTime-t.startTime,e,Math.min(t.velocity||.5,.5))},n.notes.map(e=>[e.startTime,e])).start(0)}catch(t){console.error("\u26a0\ufe0f Ambient MIDI playback failed:",t)}const e=new m.Part((e,t)=>{A.current.triggerAttackRelease(m.Frequency(t.pitch,"midi"),t.endTime-t.startTime+1,e,Math.min(t.velocity||.8,.8)),F.current&&F.current.redraw(t)},f.notes.map(e=>[e.startTime,e]));e.start(0),m.Transport.bpm.value=120,m.Transport.start(),h.current=e,b(!0)},disabled:y||!f},"Play MIDI"),r.a.createElement("button",{onClick:()=>{h.current&&(h.current.stop(),h.current.dispose(),h.current=null),m.Transport.stop(),m.Transport.cancel(),C.current.releaseAll(),b(!1)},disabled:!y},"Stop")),r.a.createElement("div",{ref:D,className:"app-visualizer-container"}),r.a.createElement("button",{onClick:()=>{const e=new URL(window.location.href);e.pathname="/player",e.searchParams.set("midi",l),e.searchParams.set("ambient",s),window.open(e.toString(),"_blank")},disabled:!l},"Open Fullscreen Player")))};n(359);var u=function(){const e=Object(a.useRef)(null),t=Object(a.useRef)(null),n=Object(a.useRef)(null),c=Object(a.useRef)(null),[l,o]=Object(a.useState)(null),s=new URLSearchParams(window.location.search),p=s.get("midi"),u=s.get("ambient");return Object(a.useEffect)(()=>{const e=new m.Reverb({decay:8,wet:.7}).toDestination(),t=new m.FeedbackDelay({delayTime:"8n",feedback:.025,wet:.1}),a=new m.Filter({type:"lowpass",frequency:1600,Q:1}),r=new m.Volume(-1);r.connect(a),a.connect(t),t.connect(e);const l=new m.Sampler({urls:{A0:"A0.mp3",C1:"C1.mp3","D#1":"Ds1.mp3","F#1":"Fs1.mp3",A1:"A1.mp3",C2:"C2.mp3","D#2":"Ds2.mp3","F#2":"Fs2.mp3",A2:"A2.mp3",C3:"C3.mp3","D#3":"Ds3.mp3","F#3":"Fs3.mp3",A3:"A3.mp3",C4:"C4.mp3","D#4":"Ds4.mp3","F#4":"Fs4.mp3",A4:"A4.mp3",C5:"C5.mp3","D#5":"Ds5.mp3","F#5":"Fs5.mp3",A5:"A5.mp3",C6:"C6.mp3","D#6":"Ds6.mp3","F#6":"Fs6.mp3",A6:"A6.mp3",C7:"C7.mp3","D#7":"Ds7.mp3","F#7":"Fs7.mp3",A7:"A7.mp3",C8:"C8.mp3"},release:1,baseUrl:"https://tonejs.github.io/audio/salamander/",onload:()=>console.log("\u2705 Sampler loaded")}).connect(r);n.current=l;const o=new m.PolySynth(m.Synth,{oscillator:{type:"fatsawtooth",count:3,spread:40},envelope:{attack:.05,decay:.2,sustain:.8,release:1}}),s=new m.Volume(-24),i=new m.Filter({type:"lowpass",frequency:600,Q:1}),p=new m.Reverb({decay:10,preDelay:.2}).toDestination(),u=new m.FeedbackDelay("4n",.3).connect(p);o.chain(s,i,u),c.current=o;const d=new m.LFO("0.05hz",400,1e3);d.connect(i.frequency),d.start()},[]),Object(a.useEffect)(()=>{p&&(async()=>{const n=await fetch(p),a=await n.arrayBuffer(),r=i.b(a);o(r),e.current&&(e.current.innerHTML="",t.current=new i.a(r,e.current,{noteRGB:"255,255,255",activeNoteRGB:"255,150,180",pixelsPerTimeStep:200,noteHeight:7}))})()},[p]),r.a.createElement("div",{className:"fullscreen-player"},r.a.createElement("div",{className:"visualizer-container",ref:e}),r.a.createElement("button",{className:"fullscreen-play",onClick:async()=>{if(await m.start(),u){const e=await fetch(u),t=await e.arrayBuffer(),n=i.b(t);new m.Part((e,t)=>{c.current.triggerAttackRelease(m.Frequency(t.pitch,"midi"),t.endTime-t.startTime,e,Math.min(t.velocity||.5,.5))},n.notes.map(e=>[e.startTime,e])).start(0)}new m.Part((e,a)=>{n.current.triggerAttackRelease(m.Frequency(a.pitch,"midi"),a.endTime-a.startTime+1,e,Math.min(a.velocity||.8,.8)),t.current&&t.current.redraw(a)},l.notes.map(e=>[e.startTime,e])).start(0),m.Transport.start()}},"Play"))};function d(){return r.a.createElement(o.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/",element:r.a.createElement(p,null)}),r.a.createElement(s.a,{path:"/player",element:r.a.createElement(u,null)})))}l.a.createRoot(document.getElementById("root")).render(r.a.createElement(d,null))}},[[277,1,2]]]);
//# sourceMappingURL=main.f8a3b17b.chunk.js.map